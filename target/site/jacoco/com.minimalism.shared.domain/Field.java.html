<?xml version="1.0" encoding="UTF-8"?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd"><html xmlns="http://www.w3.org/1999/xhtml" lang="en"><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8"/><link rel="stylesheet" href="../jacoco-resources/report.css" type="text/css"/><link rel="shortcut icon" href="../jacoco-resources/report.gif" type="image/gif"/><title>Field.java</title><link rel="stylesheet" href="../jacoco-resources/prettify.css" type="text/css"/><script type="text/javascript" src="../jacoco-resources/prettify.js"></script></head><body onload="window['PR_TAB_WIDTH']=4;prettyPrint()"><div class="breadcrumb" id="breadcrumb"><span class="info"><a href="../jacoco-sessions.html" class="el_session">Sessions</a></span><a href="../index.html" class="el_report">file-slice-and-dice-shared</a> &gt; <a href="index.source.html" class="el_package">com.minimalism.shared.domain</a> &gt; <span class="el_source">Field.java</span></div><h1>Field.java</h1><pre class="source lang-java linenums">package com.minimalism.shared.domain;

import java.lang.reflect.InvocationTargetException;
import java.lang.reflect.Method;
import java.lang.reflect.Modifier;
import java.math.BigDecimal;
import java.time.LocalDate;
import java.time.LocalTime;
import java.util.Objects;

import javax.json.Json;
import javax.json.JsonObject;

import com.minimalism.shared.common.AllEnums.DataTypes;

import org.apache.commons.text.CaseUtils;

public class Field {
    private String name;
    private DataTypes dataType;
    private Object value;

<span class="fc" id="L23">    public Field() {}</span>

<span class="fc" id="L25">    public Field(String name, DataTypes dataType, Object value) {</span>
<span class="fc" id="L26">        this.setName(name);</span>
<span class="fc" id="L27">        this.setDataType(dataType);</span>
<span class="fc" id="L28">        this.setValue(value);</span>
<span class="fc" id="L29">    }</span>

    public String getName() {
<span class="fc" id="L32">        return name;</span>
    }

    public void setName(String name) {
<span class="fc" id="L36">        this.name = name;</span>
<span class="fc" id="L37">    }</span>

    public DataTypes getDataType() {
<span class="fc" id="L40">        return dataType;</span>
    }

    public String dataTypeClassName() {
<span class="fc" id="L44">        return CaseUtils.toCamelCase(this.getDataType().name(), true, '_');</span>
    }

    public void setDataType(DataTypes dataType) {
<span class="fc" id="L48">        this.dataType = dataType;</span>
<span class="fc" id="L49">    }</span>

    public String getValue() {
<span class="fc" id="L52">        return value.toString();</span>
    }

    public void setValue(Object value) {
<span class="fc" id="L56">        setValueAsTargetType(value);</span>
<span class="fc" id="L57">    }</span>

    public JsonObject asJson() {
<span class="fc" id="L60">        return Json.createObjectBuilder()</span>
<span class="fc" id="L61">            .add(&quot;name&quot;, this.getName())</span>
<span class="fc" id="L62">            .add(&quot;dataType&quot;, CaseUtils.toCamelCase(this.getDataType().name(), true, '_'))</span>
<span class="fc" id="L63">            .add(&quot;value&quot;, this.value.toString())</span>
<span class="fc" id="L64">            .build();</span>
    }

    // public String getAvroSchemaJson() {
    //     org.apache.avro.Schema avroField = org.apache.avro.SchemaBuilder
    //     .record(&quot;Field&quot;).namespace(&quot;com.minimalism.shared.domain&quot;)
    //         .fields()//.requiredLong(&quot;requestTime&quot;)
    //             .name(&quot;name&quot;).type(&quot;string&quot;).noDefault()
    //             .name(&quot;dataType&quot;).type(this.dataType.getTypeName()).withDefault(DataTypes.STRING.name())
    //             .name(&quot;value&quot;).type(this.dataType.getTypeName().toLowerCase())
    //             .noDefault()
    //         .endRecord();
            
    //     return avroField.toString();
    // }

    private void setValueAsTargetType(Object value) {
<span class="pc bpc" id="L81" title="1 of 2 branches missed.">        if(value == null) {</span>
<span class="nc" id="L82">            this.value = null;</span>
<span class="nc" id="L83">            return;</span>
        }
<span class="fc" id="L85">        String temp = String.valueOf(value);</span>
<span class="pc bpc" id="L86" title="1 of 10 branches missed.">        switch(this.getDataType()) {</span>
            case BOOLEAN:
<span class="fc" id="L88">            TypeConverter&lt;Boolean&gt; tcb = new TypeConverter&lt;&gt;(Boolean.class);</span>
<span class="fc" id="L89">            this.value = tcb.convert(value);</span>
<span class="fc" id="L90">            break;</span>
            case BIG_DECIMAL:
<span class="fc" id="L92">            TypeConverter&lt;BigDecimal&gt; tcbd = new TypeConverter&lt;&gt;(BigDecimal.class);</span>
<span class="fc" id="L93">            this.value = tcbd.convert(value);</span>
<span class="fc" id="L94">            break;</span>
            case DOUBLE:
<span class="fc" id="L96">            TypeConverter&lt;Double&gt; tcd = new TypeConverter&lt;&gt;(Double.class);</span>
<span class="fc" id="L97">            this.value = tcd.convert(value);</span>
<span class="fc" id="L98">            break;</span>
            case FLOAT:
<span class="fc" id="L100">            TypeConverter&lt;Float&gt; tcf = new TypeConverter&lt;&gt;(Float.class);</span>
<span class="fc" id="L101">            this.value = tcf.convert(value);</span>
<span class="fc" id="L102">            break;</span>
            case INTEGER:
<span class="fc" id="L104">            TypeConverter&lt;Integer&gt; tci = new TypeConverter&lt;&gt;(Integer.class);</span>
<span class="fc" id="L105">            this.value = tci.convert(value);</span>
<span class="fc" id="L106">            break;</span>
            case LOCAL_DATE:
<span class="fc" id="L108">            TypeConverter&lt;LocalDate&gt; tcld = new TypeConverter&lt;&gt;(LocalDate.class);</span>
<span class="fc" id="L109">            this.value = tcld.convert(value);</span>
<span class="fc" id="L110">            break;</span>
            case LOCAL_TIME:
<span class="fc" id="L112">            TypeConverter&lt;LocalTime&gt; tclt = new TypeConverter&lt;&gt;(LocalTime.class);</span>
<span class="fc" id="L113">            this.value = tclt.convert(value);</span>
<span class="fc" id="L114">            break;</span>
            case LONG:
<span class="fc" id="L116">            TypeConverter&lt;Long&gt; tcl = new TypeConverter&lt;&gt;(Long.class);</span>
<span class="fc" id="L117">            this.value = tcl.convert(value);</span>
<span class="fc" id="L118">            break;</span>
            case STRING:
<span class="fc" id="L120">                this.value = temp;</span>
<span class="fc" id="L121">            break;</span>
            default:
<span class="nc" id="L123">            this.value = temp;</span>
        }
<span class="fc" id="L125">    }</span>

    @Override
    public String toString() {
<span class="nc" id="L129">        return this.asJson().toString();</span>
    }

    @Override
    public int hashCode() {
        // each field name must be unique...  
<span class="fc" id="L135">        return Objects.hash(this.getName(), this.getDataType());</span>
    }

    @Override
    public boolean equals(Object other) {
<span class="fc bfc" id="L140" title="All 2 branches covered.">        if(other == null) return false;</span>
<span class="fc bfc" id="L141" title="All 2 branches covered.">        if(!(other instanceof Field)) return false;</span>
<span class="pc bpc" id="L142" title="1 of 2 branches missed.">        return this.hashCode() == other.hashCode();</span>
    }

    protected class TypeConverter&lt;T&gt; {
        private Class&lt;T&gt; type;

<span class="fc" id="L148">        public TypeConverter(Class&lt;T&gt; type) {</span>
<span class="fc" id="L149">            this.type = type;</span>
<span class="fc" id="L150">        }</span>

        private BigDecimal toBigDecimal(String value) {
<span class="fc" id="L153">            return new BigDecimal(value);</span>
        }

        protected T convert(Object value) {
<span class="fc" id="L157">            T returnValue = null;</span>
<span class="fc bfc" id="L158" title="All 2 branches covered.">            if(type.isInstance(value)) {</span>
<span class="fc" id="L159">                returnValue = type.cast(value);</span>
<span class="fc" id="L160">            } else {</span>
<span class="fc" id="L161">                returnValue = type.cast(assignFromString(value.toString()));</span>
            }
<span class="fc" id="L163">            return returnValue;</span>
        }

        private Object fromStaticMethod(Method m, String value) {
<span class="fc" id="L167">            Object returnValue = null;</span>
            try {
<span class="fc" id="L169">                returnValue = m.invoke(null, value);</span>
<span class="pc" id="L170">            } catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException e) {</span>
<span class="nc" id="L171">                e.printStackTrace();</span>
            }
<span class="fc" id="L173">            return returnValue;</span>
        }

        private Object fromPublicMethod(Method m, String value) {
<span class="nc" id="L177">            Object returnValue = null;</span>
            try {
<span class="nc" id="L179">                Class&lt;?&gt;[] paramTypes = null;</span>
<span class="nc" id="L180">                returnValue = type.cast(m.invoke(type.getDeclaredConstructor(paramTypes)</span>
<span class="nc" id="L181">                    .newInstance((Object[])paramTypes), value));</span>
<span class="nc" id="L182">            } catch (IllegalAccessException | IllegalArgumentException | InvocationTargetException</span>
<span class="nc" id="L183">                        | InstantiationException | NoSuchMethodException | SecurityException e) {</span>
<span class="nc" id="L184">                    e.printStackTrace();</span>
            }
<span class="nc" id="L186">            return returnValue;</span>
        }

        private Object assignFromString(String value) {
<span class="fc bfc" id="L190" title="All 2 branches covered.">            if(type.isAssignableFrom(java.math.BigDecimal.class)) {</span>
<span class="fc" id="L191">                return this.toBigDecimal(value);</span>
            }
<span class="fc" id="L193">            Method[] methods = type.getDeclaredMethods();</span>
<span class="pc bpc" id="L194" title="1 of 2 branches missed.">            for(Method m : methods) {</span>
<span class="fc bfc" id="L195" title="All 2 branches covered.">                if(m.getName().contains(&quot;parse&quot;)) {</span>
<span class="pc bpc" id="L196" title="1 of 4 branches missed.">                    if(Modifier.isStatic(m.getModifiers()) &amp;&amp; m.getParameterCount() == 1) {</span>
<span class="fc" id="L197">                        return fromStaticMethod(m, value);</span>
<span class="pc bpc" id="L198" title="2 of 4 branches missed.">                    } else if(Modifier.isPublic(m.getModifiers()) &amp;&amp; m.getParameterCount() == 1) {</span>
<span class="nc" id="L199">                        return fromPublicMethod(m, value);</span>
                    }
                }
            }
<span class="nc" id="L203">            return value;</span>
        }
    }
    
}
</pre><div class="footer"><span class="right">Created with <a href="http://www.jacoco.org/jacoco">JaCoCo</a> 0.8.7.202105040129</span></div></body></html>